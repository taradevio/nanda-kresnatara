---
import client from "../../tina/__generated__/client";

const resp = await client.queries.postConnection();
const posts = (resp.data.postConnection?.edges ?? [])
  .map((e) => e?.node ?? null)
  .filter((n): n is NonNullable<typeof n> => n !== null);

// kalau kamu pakai subfolder di content/blog, pakai breadcrumbs:
const toSlug = (n: (typeof posts)[number]) =>
  n._sys.breadcrumbs?.length ? n._sys.breadcrumbs.join("/") : n._sys.filename;
---

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
  {
    posts.map((p) => {
      const slug = toSlug(p);
      return (
        <div class="">
          {p.image && (
            <img
            src={p.image}
            alt={p.alt ?? p.title}
            class="w-full aspect-square object-cover rounded"
            />
          )}
          <h2 class="text-2xl md:text-3xl pt-3 font-semibold">{p.title}</h2>
          <p class="truncate">{p.description}</p>
          {p.datetime && (
            <time class="text-sm block text-right mt-2">
              {new Date(p.datetime).toLocaleDateString()}
            </time>
          )}
          <a
            href={`/blog/${slug}`}
            class="block"
          >
            <button class="w-full py-2 rounded-sm border-1 hover:shadow cursor-pointer block">Read More</button>
          </a>
        </div>
      );
    })
  }
</div>
